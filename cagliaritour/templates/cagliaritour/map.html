{% extends 'cagliaritour/base.html' %}
{% block content %}

<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>










<script>
    let map

    function initMap(){

        var locations = {{ locations|safe}};
        var firstLocation = locations[0]
        var secondLocation =locations[1]
        var infoWindow = []

        map = new google.maps.Map(document.getElementById("map"),{
            center: { lat: firstLocation.lat, lng: firstLocation.lng },
            zoom: 6,

        }
        );
  const icons = {
    cathedral: {
      icon: "https://maps.google.com/mapfiles/kml/pal3/icon31.png",
    },
    stadium: {
      icon: "https://maps.google.com/mapfiles/kml/pal2/icon49.png",
    },
    info: {
      icon: "https://maps.google.com/mapfiles/kml/pal3/icon44.png",
    },
  };
        locations.forEach(function (location){
            var marker = new google.maps.Marker({
                position: {lat: location.lat, lng: location.lng},
                map: map,
                title: location.name,
                icon :icons["info"].icon
            });

            var infowindow = new google.maps.InfoWindow({
                content: location.name + " " + location.temp + " Â°C",
            });

            infoWindow.push(infowindow)

            marker.addListener('click', function(){
                infoWindow.forEach(function(iw){
                    iw.close();
                });

                infowindow.open(map, marker)
            });
        });

const transitLayer = new google.maps.TransitLayer();

  transitLayer.setMap(map)
        drawLine (firstLocation , secondLocation);
drawRoute("64CG+X8 Cagliari, Metropolitan City of Cagliari", "V.le Regina Margherita, 33, 09124 Cagliari CA",'DRIVING','red');
drawRoute("64CG+X8 Cagliari, Metropolitan City of Cagliari", "V.le Regina Margherita, 33, 09124 Cagliari CA",'WALKING','blue');


    }


// function to draw line
    function drawLine (firstLocation , secondLocation){

            var origin = new google.maps.LatLng(firstLocation.lat, firstLocation.lng);
    var destination = new google.maps.LatLng(secondLocation.lat, secondLocation.lng);

    var line = new google.maps.Polyline({
        path: [origin, destination],
        geodesic: true,
        strokeColor: '#aa03e8',
        strokeOpacity: 1.0,
        strokeWeight: 2
    });

    line.setMap(map);



    }

    function drawRoute(startingAddress, destinationAddress, travelMode, color){


        // Create a DirectionsService object to use the route method and get a result
    var directionsService = new google.maps.DirectionsService;

    // Create a DirectionsRenderer object to display the route
    var directionsDisplay = new google.maps.DirectionsRenderer({
        map: map,
         polylineOptions: {
        strokeColor: color // Set the desired color here
    }
    });

    // Define the waypoints and origin/destination
    var waypoints = [
        {location: startingAddress},
        {location: destinationAddress}
    ];

    // Request the route
    directionsService.route({
        origin: startingAddress,
        destination: destinationAddress,
        waypoints: waypoints,
        travelMode:  travelMode// You can also use BICYCLING, WALKING, etc.
    }, function(response, status) {
        if (status === 'OK') {
            // Display the route on the map
            directionsDisplay.setDirections(response);
        } else {
            window.alert('Directions request failed due to ' + status);
        }
    });


    }






    window.initMap = initMap

</script>
<style>

    .container-fluid,
    .row,
    .col-md-3,
    .col-md-9 {
        height: 100vh;
    }

    #sidebar,
    main {
        overflow-y: auto;
    }
</style>


<div class="container-fluid">
    <div class="row">
        <!-- Fixed Sidebar -->
        <nav id="sidebar" class="col-md-3 col-lg-2 d-md-block bg-light sidebar">
            <!-- Input forms and submit button -->
            <form id="myForm" class="p-3">
                <div class="mb-3">
                    <label for="input1" class="form-label">Number of Days</label>
                    <input type="number" class="form-control" id="input1" name="input1">
                </div>
                <div class="mb-3">
                    <label for="input2" class="form-label">Hobby</label>
                    <input type="text" class="form-control" id="input2" name="input2">
                </div>
                <button type="submit" class="btn btn-primary">Submit</button>
            </form>
        </nav>

        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">

            <div class="linkholder mt-3">
                <div class="mapholder">
                    <div id="map"></div>
                    <script async src="https://maps.googleapis.com/maps/api/js?key={{key}}&callback=initMap"></script>
                </div>
            </div>

            <div class="linkholder mt-3">
                <a href="{% url 'my_home_view' %}" class="btn btn-secondary">Go to our homepage</a>
            </div>
        </main>
    </div>
</div>

{% endblock %}